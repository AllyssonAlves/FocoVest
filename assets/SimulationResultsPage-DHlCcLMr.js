import{a as N}from"./rolldown-runtime-Dq6TatWD.js";import{A as D,F as _,G as q,Mt as E,P as b,Pt as P,Tt as I,a as g,jt as B,m as O,s as M}from"./react-vendor-BpwrftXY.js";var d=N(P()),L="http://localhost:5000/api",R=class{async request(s,t={}){const r=localStorage.getItem("authToken"),n={headers:{"Content-Type":"application/json",...r&&{Authorization:`Bearer ${r}`},...t.headers},...t};try{const a=await fetch(`${L}${s}`,n);if(!a.ok){const m=await a.json().catch(()=>({message:"Erro desconhecido"}));throw new Error(m.message||`Erro ${a.status}`)}return await a.json()}catch(a){throw console.error("Erro na requisição:",a),a}}async getSimulations(s={}){const t=new URLSearchParams;Object.entries(s).forEach(([n,a])=>{a!=null&&(Array.isArray(a)?a.forEach(m=>t.append(n,m.toString())):t.append(n,a.toString()))});const r=`/simulations${t.toString()?`?${t.toString()}`:""}`;return this.request(r)}async getSimulationById(s){return this.request(`/simulations/${s}`)}async createSimulation(s){return this.request("/simulations",{method:"POST",body:JSON.stringify(s)})}async updateSimulation(s,t){return this.request(`/simulations/${s}`,{method:"PUT",body:JSON.stringify(t)})}async deleteSimulation(s){return this.request(`/simulations/${s}`,{method:"DELETE"})}async startSimulation(s){return this.request(`/simulations/${s}/start`,{method:"POST"})}async pauseSimulation(s){return this.request(`/simulations/${s}/pause`,{method:"POST"})}async resumeSimulation(s){return this.request(`/simulations/${s}/resume`,{method:"POST"})}async completeSimulation(s){return this.request(`/simulations/${s}/complete`,{method:"POST"})}async submitAnswer(s,t,r){return this.request(`/simulations/${s}/questions/${t}/answer`,{method:"POST",body:JSON.stringify({answer:r})})}async getCurrentSession(s){return this.request(`/simulations/${s}/session`)}async getSimulationResult(s){return this.request(`/simulations/${s}/result`)}async getUserStats(){return this.request("/simulations/stats")}isSimulationAccessible(s,t){return s.isPublic||s.createdBy===t}formatTime(s){const t=Math.floor(s/3600),r=Math.floor(s%3600/60),n=s%60;return t>0?`${t}h ${r}m ${n}s`:r>0?`${r}m ${n}s`:`${n}s`}calculateProgress(s,t){return t===0?0:Math.round(s/t*100)}isSimulationExpired(s,t){const r=Date.now()-new Date(s.startedAt).getTime(),n=t*60*1e3;return r>=n}getTimeRemaining(s,t){const r=Date.now()-new Date(s.startedAt).getTime(),n=t*60*1e3,a=Math.max(0,n-r);return Math.floor(a/1e3)}validateSimulationData(s){const t=[];return(!s.title||s.title.trim().length<3)&&t.push("Título deve ter pelo menos 3 caracteres"),(s.settings.timeLimit<1||s.settings.timeLimit>300)&&t.push("Tempo limite deve estar entre 1 e 300 minutos"),(s.settings.questionsCount<1||s.settings.questionsCount>100)&&t.push("Número de questões deve estar entre 1 e 100"),["geral","especifico","revisao","vestibular"].includes(s.category)||t.push("Categoria inválida"),t}cache=new Map;CACHE_DURATION=300*1e3;getCachedData(s){const t=this.cache.get(s);return t&&Date.now()-t.timestamp<this.CACHE_DURATION?t.data:null}setCachedData(s,t){this.cache.set(s,{data:t,timestamp:Date.now()})}async getSimulationsWithCache(s={}){const t=`simulations_${JSON.stringify(s)}`,r=this.getCachedData(t);if(r)return r;const n=await this.getSimulations(s);return this.setCachedData(t,n),n}clearCache(){this.cache.clear()}};const y=new R;var e=N(I());function Q(){const{simulationId:s}=E(),t=B(),[r,n]=(0,d.useState)(null),[a,m]=(0,d.useState)(null),[w,v]=(0,d.useState)([]),[S,f]=(0,d.useState)(!0),[j,p]=(0,d.useState)(null);(0,d.useEffect)(()=>{(async()=>{if(!s){p("ID do simulado não fornecido"),f(!1);return}try{const[c,l]=await Promise.all([y.getSimulationById(s),y.getSimulationResult(s)]);n(c.data),m(l.data),v([{_id:"1",text:"Qual é a capital do Brasil?",options:[{id:"A",text:"São Paulo"},{id:"B",text:"Rio de Janeiro"},{id:"C",text:"Brasília"},{id:"D",text:"Belo Horizonte"}],correctAnswer:"C",explanation:"Brasília é a capital federal do Brasil desde 1960.",subject:"Geografia",topic:"Capitais",difficulty:"easy",university:"UFC",year:2023,statistics:{totalAttempts:100,correctAttempts:80,accuracy:.8,averageTime:30},createdAt:new Date,updatedAt:new Date}])}catch(c){p("Erro ao carregar resultados"),console.error("Error loading results:",c)}finally{f(!1)}})()},[s]);const x=i=>{const c=Math.floor(i/60),l=i%60;return`${c}m ${l}s`},C=i=>i>=80?"text-green-600":i>=60?"text-yellow-600":"text-red-600",$=i=>i>=80?"bg-green-100":i>=60?"bg-yellow-100":"bg-red-100";return S?(0,e.jsx)("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:(0,e.jsxs)("div",{className:"text-center",children:[(0,e.jsx)("div",{className:"animate-spin rounded-full h-32 w-32 border-b-2 border-blue-600 mx-auto"}),(0,e.jsx)("p",{className:"mt-4 text-gray-600",children:"Carregando resultados..."})]})}):j||!r||!a?(0,e.jsx)("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:(0,e.jsxs)("div",{className:"text-center",children:[(0,e.jsx)(g,{className:"h-16 w-16 text-red-500 mx-auto mb-4"}),(0,e.jsx)("h2",{className:"text-xl font-semibold text-gray-900 mb-2",children:"Erro ao carregar resultados"}),(0,e.jsx)("p",{className:"text-gray-600 mb-4",children:j||"Resultados não encontrados"}),(0,e.jsx)("button",{onClick:()=>t("/simulations"),className:"btn-primary",children:"Voltar aos Simulados"})]})}):(0,e.jsx)("div",{className:"min-h-screen bg-gray-50 py-8",children:(0,e.jsxs)("div",{className:"max-w-4xl mx-auto px-4 sm:px-6 lg:px-8",children:[(0,e.jsxs)("div",{className:"mb-8",children:[(0,e.jsxs)("button",{onClick:()=>t("/simulations"),className:"flex items-center text-gray-600 hover:text-gray-900 mb-4",children:[(0,e.jsx)(q,{className:"h-4 w-4 mr-2"}),"Voltar aos Simulados"]}),(0,e.jsx)("h1",{className:"text-3xl font-bold text-gray-900 mb-2",children:"Resultado do Simulado"}),(0,e.jsx)("p",{className:"text-gray-600",children:r.title})]}),(0,e.jsx)("div",{className:"bg-white rounded-lg shadow-sm border p-6 mb-8",children:(0,e.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[(0,e.jsxs)("div",{className:"text-center",children:[(0,e.jsx)("div",{className:`inline-flex items-center justify-center w-20 h-20 rounded-full mb-4 ${$(a.score)}`,children:(0,e.jsx)(M,{className:`h-10 w-10 ${C(a.score)}`})}),(0,e.jsxs)("h3",{className:"text-2xl font-bold text-gray-900 mb-1",children:[a.score.toFixed(1),"%"]}),(0,e.jsx)("p",{className:"text-gray-600",children:"Pontuação Final"})]}),(0,e.jsxs)("div",{className:"text-center",children:[(0,e.jsx)("div",{className:"inline-flex items-center justify-center w-20 h-20 rounded-full bg-blue-100 mb-4",children:(0,e.jsx)(_,{className:"h-10 w-10 text-blue-600"})}),(0,e.jsxs)("h3",{className:"text-2xl font-bold text-gray-900 mb-1",children:[a.correctAnswers,"/",a.totalQuestions]}),(0,e.jsx)("p",{className:"text-gray-600",children:"Questões Corretas"})]}),(0,e.jsxs)("div",{className:"text-center",children:[(0,e.jsx)("div",{className:"inline-flex items-center justify-center w-20 h-20 rounded-full bg-purple-100 mb-4",children:(0,e.jsx)(D,{className:"h-10 w-10 text-purple-600"})}),(0,e.jsx)("h3",{className:"text-2xl font-bold text-gray-900 mb-1",children:x(a.totalTimeSpent)}),(0,e.jsx)("p",{className:"text-gray-600",children:"Tempo Total"})]})]})}),(0,e.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 mb-8",children:[(0,e.jsxs)("div",{className:"bg-white rounded-lg shadow-sm border p-6",children:[(0,e.jsx)("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Estatísticas Detalhadas"}),(0,e.jsxs)("div",{className:"space-y-3",children:[(0,e.jsxs)("div",{className:"flex justify-between",children:[(0,e.jsx)("span",{className:"text-gray-600",children:"Acertos:"}),(0,e.jsxs)("span",{className:"font-medium",children:[(a.accuracy*100).toFixed(1),"%"]})]}),(0,e.jsxs)("div",{className:"flex justify-between",children:[(0,e.jsx)("span",{className:"text-gray-600",children:"Tempo médio por questão:"}),(0,e.jsx)("span",{className:"font-medium",children:x(a.averageTimePerQuestion)})]}),(0,e.jsxs)("div",{className:"flex justify-between",children:[(0,e.jsx)("span",{className:"text-gray-600",children:"Data de conclusão:"}),(0,e.jsx)("span",{className:"font-medium",children:new Date(a.completedAt).toLocaleDateString("pt-BR")})]})]})]}),(0,e.jsxs)("div",{className:"bg-white rounded-lg shadow-sm border p-6",children:[(0,e.jsx)("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Performance por Matéria"}),(0,e.jsxs)("div",{className:"space-y-3",children:[(0,e.jsxs)("div",{className:"flex justify-between items-center",children:[(0,e.jsx)("span",{className:"text-gray-600",children:"Geografia"}),(0,e.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,e.jsx)("div",{className:"w-24 h-2 bg-gray-200 rounded-full",children:(0,e.jsx)("div",{className:"h-2 bg-green-500 rounded-full",style:{width:"80%"}})}),(0,e.jsx)("span",{className:"text-sm font-medium",children:"80%"})]})]}),(0,e.jsxs)("div",{className:"flex justify-between items-center",children:[(0,e.jsx)("span",{className:"text-gray-600",children:"História"}),(0,e.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,e.jsx)("div",{className:"w-24 h-2 bg-gray-200 rounded-full",children:(0,e.jsx)("div",{className:"h-2 bg-yellow-500 rounded-full",style:{width:"65%"}})}),(0,e.jsx)("span",{className:"text-sm font-medium",children:"65%"})]})]}),(0,e.jsxs)("div",{className:"flex justify-between items-center",children:[(0,e.jsx)("span",{className:"text-gray-600",children:"Matemática"}),(0,e.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,e.jsx)("div",{className:"w-24 h-2 bg-gray-200 rounded-full",children:(0,e.jsx)("div",{className:"h-2 bg-red-500 rounded-full",style:{width:"45%"}})}),(0,e.jsx)("span",{className:"text-sm font-medium",children:"45%"})]})]})]})]})]}),(0,e.jsxs)("div",{className:"bg-white rounded-lg shadow-sm border p-6 mb-8",children:[(0,e.jsx)("h3",{className:"text-lg font-semibold text-gray-900 mb-6",children:"Revisão das Questões"}),(0,e.jsx)("div",{className:"space-y-6",children:a.questionsBreakdown.map((i,c)=>{const l=w.find(o=>o._id===i.questionId);return l?(0,e.jsxs)("div",{className:"border-b pb-6 last:border-b-0",children:[(0,e.jsxs)("div",{className:"flex items-start justify-between mb-4",children:[(0,e.jsxs)("h4",{className:"text-md font-medium text-gray-900",children:["Questão ",c+1]}),(0,e.jsxs)("div",{className:"flex items-center space-x-2",children:[i.isCorrect?(0,e.jsx)(b,{className:"h-5 w-5 text-green-500"}):(0,e.jsx)(g,{className:"h-5 w-5 text-red-500"}),(0,e.jsx)("span",{className:`text-sm font-medium ${i.isCorrect?"text-green-600":"text-red-600"}`,children:i.isCorrect?"Correto":"Incorreto"})]})]}),(0,e.jsx)("p",{className:"text-gray-900 mb-4",children:l.text}),(0,e.jsx)("div",{className:"space-y-2 mb-4",children:l.options.map((o,T)=>{const A=String.fromCharCode(65+T),u=o.id===l.correctAnswer,h=o.id===i.userAnswer;return(0,e.jsx)("div",{className:`p-3 rounded-lg border ${u?"border-green-300 bg-green-50":h?"border-red-300 bg-red-50":"border-gray-200"}`,children:(0,e.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,e.jsx)("span",{className:`w-6 h-6 rounded-full border-2 flex items-center justify-center text-sm font-medium ${u?"border-green-500 bg-green-500 text-white":h?"border-red-500 bg-red-500 text-white":"border-gray-300 text-gray-500"}`,children:A}),(0,e.jsx)("span",{className:"text-gray-900",children:o.text}),u&&(0,e.jsx)(b,{className:"h-4 w-4 text-green-500 ml-auto"}),h&&!u&&(0,e.jsx)(g,{className:"h-4 w-4 text-red-500 ml-auto"})]})},o.id)})}),l.explanation&&(0,e.jsxs)("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:[(0,e.jsx)("h5",{className:"font-medium text-blue-900 mb-2",children:"Explicação:"}),(0,e.jsx)("p",{className:"text-blue-800",children:l.explanation})]}),i.timeSpent&&(0,e.jsxs)("div",{className:"mt-4 text-sm text-gray-500",children:["Tempo gasto: ",x(i.timeSpent)]})]},i.questionId):null})})]}),(0,e.jsxs)("div",{className:"flex justify-center space-x-4",children:[(0,e.jsx)("button",{onClick:()=>t("/simulations"),className:"btn-secondary",children:"Ver Outros Simulados"}),(0,e.jsxs)("button",{onClick:()=>t(`/integrated-simulation/${s}`),className:"btn-primary flex items-center space-x-2",children:[(0,e.jsx)(O,{className:"h-4 w-4"}),(0,e.jsx)("span",{children:"Refazer Simulado"})]})]})]})})}export{Q as default};
